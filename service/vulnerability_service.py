from service.input_service import execute_command
from model.vulnerability import Vulnerability
from datetime import datetime
import os

vulnerabilities = []

def search_sensitive_log(data):       

    output = execute_command(f"adb logcat -d | grep {data} | tail -n 8")

    if output:
        print(f"[+] Sensitive data '{data}' were found in logs")        

        INSECURE_LOGGING_CWE = os.getenv("INSECURE_LOGGING_CWE")
        INSECURE_LOGGING_SEV = os.getenv("INSECURE_LOGGING_SEV")
        INSECURE_LOGGING_NAME = os.getenv("INSECURE_LOGGING_NAME")
        INSECURE_LOGGING_DESC = os.getenv("INSECURE_LOGGING_DESC")
        INSECURE_LOGGING_REFS = os.getenv("INSECURE_LOGGING_REFS")        
        INSECURE_LOGGING_REMEDIATION = os.getenv("INSECURE_LOGGING_REMEDIATION")
        #@todo test the creation of the object

        vulnerability = Vulnerability(INSECURE_LOGGING_NAME, INSECURE_LOGGING_DESC, output, INSECURE_LOGGING_SEV, INSECURE_LOGGING_CWE, datetime.now(), INSECURE_LOGGING_REMEDIATION, INSECURE_LOGGING_REFS)

        vulnerabilities.append(vulnerability)

        print(f"[+] Vulnerability [{INSECURE_LOGGING_NAME}] Added")


def get_vulnerabilities():
    return vulnerabilities